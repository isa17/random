<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Random</title>
	<!--
	 Original by Thiago Esser (@thiagoesser) & Alexander Chu (@webchu) for UXConfBR (http://www.uxconf.com.br)
	 View project on GitHub: https://github.com/thiagoesser/uxconf
	 (CC BY) 2016
	 -->
	
	<!-- <link rel="stylesheet" href="/css/random.css"> -->
	<style>
		@import url('./css/random.min.css');
		
		body .wrapper:before, body .wrapper:after {
			box-shadow: none;
		}
		body .wrapper {
			border: none;
		}
	</style>
	<script src="./js/jquery.min.js"></script>
</head>
<body>

	<div class="wrapper">
		<!-- lista de nomes -->
		<ul id="list">
			<li>Nome 1</li>
			<li>Nome 2</li>
		</ul>
	</div>

	<div class="actions">
		<button id="play" class="play" onclick="javascript:play();"><img src="play.svg" style="
	      width: 80px;"></button>
	</div>

	<img src="./images/logo-branco-isa.svg" style="
	    width: 300px;
	    display: block;
	    position: fixed;
	    left: 5%;
	    bottom: 5%;
	">

	<img src="./images/mane.svg" style="
	    display: block;
	    position: fixed;
	    right: -110px;
	    bottom: -40px;
	    height: 550px;
	">

	<img src="./images/parabens.svg" id="congratulations">

	<input type="file" id="file" name="file" style="display: none;" />

	<script>
		let currentSong;
		let songs = [
			'musics/epicSaxGuy.mp3',
			'musics/macintoshPlus.mp3',
			'musics/piaoCasaPropria.mp3',
			'musics/rufarTambores.mp3',
			'musics/telesena.mp3',
			'musics/thePriceIsRight.mp3',
			'musics/topGear.mp3',
			'musics/neverGonnaGiveYouUp.mp3'
		]
		
		var count = 0,
			loop = 0,
			list = document.getElementById('list'),
			countNames,
			random = 0,
			names;

		var play = function() {
			shuffleDomList();
			disableButton();
			congratulationsFadeOut();
			randomizeSong();
			currentSong.play();
			countNames = list.getElementsByTagName('li').length;
			list.className = 'selecting';
			count = 0;
			loop = 0;
			random = Math.floor(Math.random() * countNames);
			shuffle();
		};

		var randomizeSong = function() {
			randomNumber = Math.floor(Math.random() * (songs.length));
			currentSong = new Audio(songs[randomNumber])
		}

		var musicFadeOut = function () {
			if (currentSong.volume > 0.1) {
				currentSong.volume = currentSong.volume - 0.1;
				setTimeout(musicFadeOut,20)
			}
		}

		var congratulationsFadeIn = function() {
			$('#congratulations').addClass('fadeIn');
		}

		var congratulationsFadeOut = function() {
			$('#congratulations').removeClass('fadeIn');
		}

		var disableButton = function() {
    		$("#play").prop("disabled",true);
		}

		var enableButton = function() {
    		$("#play").prop("disabled",false);
		}

		var shuffleArray = function(array) {
		    for (var i = array.length - 1; i > 0; i--) {
		        var j = Math.floor(Math.random() * (i + 1));
		        var temp = array[i];
		        array[i] = array[j];
		        array[j] = temp;
		    }
		    return array;
		}

		var putListInDom = function(names) {
			var html = '';
			for (var i in names) {
				if (names[i].charAt(0) == '#') {
					html += '<li class="none"><span>' + names[i].substr(1) + '</span></li>';
				} else {
					html += '<li><span>' + names[i] + '</span></li>';
				}
			}
			var el = document.getElementById('list');
			el.innerHTML = html;
		}

		var clearDomList = function() {
			let domList = $('#list');
			domList.empty();
		}

		var shuffleDomList = function() {
			clearDomList();
			names = shuffleArray(names);
			putListInDom(names);
		}

		var shuffle = function() {
			if (count >= 0) {
				var el = list.style.top = -(count * 240) + 'px';
			}

			count++;

			//executa so no final
			//dividido por 3 para ser mais rÃ¡pido com uma lista de 1500 pessoas
			if ( count > 0 && count >= (countNames/3)) {
				loop++;
				count = 0;
			}

			//executa so no final
			if (loop >= 1) {
				var el = list.style.top = -(random * 240) + 'px';
				musicFadeOut();
				congratulationsFadeIn();
				enableButton();
			} else {
				setTimeout(shuffle, 20);
			}
		}

		// window.open('./random-control.html', 'Sorteio de Nomes', 'menubar=1, resizable=1, width=150, height=150');

		function handleFileSelect(evt) {
		    var file = evt.target.files;

			var reader = new FileReader();

			reader.onload = (function(theFile) {
				return function(e) {
					names = e.target.result.split('\n');
					putListInDom(names);
				};
			})(file[0]);
	      	reader.readAsText(file[0]);
		}
		document.getElementById('file').addEventListener('change', handleFileSelect, false);
	</script>

	<script>
		$(function() {
			$(document).on("keydown", function(e){ 
			    e = e || window.event;
			    var charCode = e.which || e.keyCode;
			    if(charCode == 70) {
					$('#file').trigger('click')
			    }
			});
		});
	</script>
</body>
</html>
